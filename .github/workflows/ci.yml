# CI：脚本语法检查与（可选）Node 依赖安装校验
# 在 push 与 pull_request 时自动运行
name: CI

on:
  push:
    branches: [main, master]
  pull_request:
    branches: [main, master]

jobs:
  shell-check:
    name: Shell 脚本语法检查
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: 检查 deploy.sh 与 scripts/*.sh 语法
        run: |
          bash -n deploy.sh
          for f in scripts/*.sh; do bash -n "$f" || exit 1; done
          echo "All shell scripts passed syntax check."

  node-check:
    name: bigclaw 依赖与结构
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: 设置 Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'
          cache-dependency-path: src/bigclaw/package-lock.json

      - name: 安装 bigclaw 依赖
        working-directory: src/bigclaw
        run: npm ci --ignore-scripts

      - name: 校验 bigclaw 入口
        working-directory: src/bigclaw
        run: |
          node -e "import('./index.js').then(m => console.log('OK', typeof m.default)).catch(e => { console.error(e); process.exit(1); })"
